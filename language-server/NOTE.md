if you only have a hammer, then everything you see look like a nail.

## 사용자는 누구인가?

- (대부분) 프로그래밍에 익숙하지 않고, 간단한 XML 위주의 작업을 하는 사람들.
- 림월드 모딩을 주력으로 함.
- 대부분 XML, 또는 html 등의 마크업 언어를 이해하는 것이 대부분이다.
- C# 의 사용법을 모르는 사람이 꽤 많고, config json 을 주는 것이 좋은 선택이 아닐 수 있다.

## 구현하고자 하는 목표는 무엇인가?

(중요도 순서로 나열해야 한다)

1. 자동 완성 = autocomplete

2. 에러 검사 및 검출 = validation

3. 수정 방안을 알려줌
  - 번역을 넣을 수 있을까?

4. 미리보기 등의 기능을 넣을 수 있다.

## 이 프로그램의 목표는 무엇인가?

- cli 기능을 제공하지는 않는다 (나중에 구현 가능할 수 있다)
- 라이브러리로 역할을 수행하게 될 것이며, 대상은 vscode 플러그인 호스트이다.  
  즉, 해당 플러그인 코드가 이 라이브러리 코드를 호출한다.
- 디버깅이 수월해야 한다.
- 테스트 코드를 작성하는 것이 유리할 것이다.
- 라이브러리는 여러 개의 모듈의 조합으로 이루어 지면 좋을 것이고, 최대한 "기술적 부채" 가 없도록 설계를 해야 한다.

## 구현 순서
모든 코드는 테스트 코드를 작성할 수 있도록 노력한다.
1. XML 구현  
2. Def 에 대한 자료구조 구현
3. 상속 / reference 구현
4. Project 에 대하여 구현
5. 

## 주요 주제

### 공통 스펙 (라이브러리, 즉 현재 프로젝트)

- 유효한 XML 문서가 주어지면, 파싱 후 에러를 검출할 수 있어야 한다.
- 문서가 outdated 될 경우, update 가능 해야 한다.
- 성능상 문제를 해결하기 위해, 문서의 update 는 mark-and-sweep 처럼 부분적으로 이뤄질 수 있어야 한다.
- 객체는 (상호)참조 될 수 있다.
- 1.0, 1.1, 1.2 등 림월드 버전이 여러 개일 수 있다.
  - 이 경우는 어떻게 해야할까... 프로젝트 단위로 분리를 하면 되지 않을까?
  - 그럴 경우, XML 파일이 어디서 온 것인지 알아야 한다.
    - 이것에 대해서는 어떻게 할까? -> non-specified version = universal 으로 사용하자.
    - 사용자가 option 을 넣어줄 수 있도록 하는게 맞지 않을까?
- 디버깅을 잘 할 수 있어야 한다.
  - 에러 메세지를 잘 출력할 수 있어야 한다...
  - 놀람 최소 법칙을 잘 따르자.
- 각 Project 는 event 를 trigger 할 수 있고, 이 것을 subscribe 하는 방식으로 구현을 하자.
- 테스트를 쉽게 할 수 있도록 작성하고, 최대한 dependency 를 줄이는 방향으로 가자.

### XML Def research

- 시그니쳐는 어떠한가?
  - Namespace.ClassName 형태를 가지고 있다.
- 몇몇 자료 구조는 독자적인 표현 방법을 가지고 있다.
  - List\<T>
    - \<li> 노드를 이용하여 표현되고, \<T> 는 primitive, 또는 일반 class 가 가능하다.
    - 몇몇 예외 케이스가 존재하고, 이 경우 \<li> 를 사용하지 않고도 표현 가능하다. Array
    - 사용하지 않는 것으로 보이나, 사용할 경우 결과를 찾아보자.
- 객체의 최소 단위는 \<Def> 노드 이다.
  - 추가적으로, ParentName 과 Class 를 가질 수 있다.
  - 몇몇 필수 노드가 있고, 이 것을 규정하는 것은 다른 모듈에서 정의한다.
    (최소 기능만 구현하는 것을 목적으로 하자)
- 당연하지만, 상속 시스템이 있다.
  - 상속 시스템은 매우 중요하다! 그리고 복잡하다.
- 다른 Def 을 reference 가능하다.
  - 무엇을?
    - Def 을 상속한 모든 것
  - 어떻게?
    - defName 을 기준으로 한다.
  - 예외가 있는가?
    - namespace 미지정일 경우, "RimWorld" namespace 를 이용한다. 아닐 경우 Full name 이용함

- Name 과 DefName 의 차이점
  - Name
    - 상속에 사용된다.
  - defName
    - reference 에 사용된다.
    - 없을 경우, 대부분 Abstract 이다.

- 타입 시스템을 사용하기 위해선, 추출 데이터를 필요로 한다.
  - 웹에서 가져오는 것으로 하자. (자체 추출을 하는 것은 멍청한 생각이었음)
  - 2중으로 설계하자.
    1. manifest file 을 가져온다.
    2. manifest 데이터를 기반으로, 모든 데이터를 가져온다.

### 파일 시스템, 그리고 rimworld version 에 대하여

- 여러 버전을 지원할 수 있어야 한다!
- 그런데, 이 버전을 지원하는 것은 누구의 책임인가?
  - 라이브러리 코드의 책임인가?
    - 내 생각엔 이 쪽의 책임이 옳다고 생각한다.
  - vscode plugin 쪽의 책임인가?

- 이전에 사용하였던 `rwconfigrc.json` 방식은 너무 불친절하였다.
  - 설정하기 어려웠고, 사람들이 이해하지도 못하였음.
    - 사용 대상을 고려하지 않은 선택이었다.
- XML 의 노드에 annotation 을 달아서 데이터를 표현할 수 있도록 하자.
  1. 파일의 xml 선언 부분에 추가적인 데이터 넣기
  2. 폴더에 버전을 선언하는 데이터 넣기
  3. 없을 경우, universal 버전으로 사용할 수 있도록 하기.
- universal 버전 같은 경우엔, 어떻게 해야 하는 것이지?
  - 예를 들어, XML 은 버전으로 나뉘어져 있지만, 이미지 같은 것은 공용 resource 일 수도 있다.
    - def 만 versioning 을 하고, 공용 리소스의 경우에는 그러지 않는 것으로 하자.

### 프로그램의 구조

- VirtualDirectory
  - 모든 리소스를 관리하는 일종의 폴더이며, 실제 경로와 가상 경로를 매핑한다.
  - 프로그램은 VirtualDirectory 의 경로를 기반으로 동작을 하도록 구현한다.
  
- XML
  - 하나의 XML Node 를 기준으로 구현한다.
  - 사용할 라이브러리를 선택해보자.
    - 자체 구현(마소꺼 코드 그대로 사용)
      - 확장성 좋음
      - 아무래도 유지보수가 조금 힘들수도 있다...?
      - xpath 를 적용할 수 없고, 사용하려면 직접 xpath 를 구현해야 한다.

    - DOMParser() 를 사용하는 것은 어떨까?
      - text 의 offset 을 제대로 알아 낼 수 없으므로, 부적합하다.
  
    - jQuery() 를 사용하는 것은 어떨까?
      - xpath 도 지원하고, xml 파싱도 지원하고, offset 에 대해서도 제대로 표현을 해주는 것 같다.
      - 아직 테스트를 안해서, 제대로 파악을 해 봐야함.
  - 원본 문서(전체) 에 대한 참조를 가지고 있어야 한다.
  
- Def
  - 림월드의 base resource
  - XML 노드에 결합을 하는 것이 좋을까? 아니면 nested object 로 하는 것이 좋을까?
    - mixin 을 할 경우, 많이 불편한 느낌이 있던데... reference 를 가지고 있는게 낫지 않을까?
    - 일단 필요한 type 을 적어보고, 생각해보자.
  - 상속을 구현해야 하고, 레퍼런스도 구현해야 한다.
    - 이전엔 mixin 패턴을 사용했는데, 좀 불편하였다.
    - 그냥 class 상속으로 구현하는 것이 맞는게 아닐까?
    - 그냥 전부 다 때려박고 구별하지 않는게 좋을 것 같다.
  - 필요한 기능들
    - Def 에 대한 메타데이터.
    - Def 의 field 에 대한 정보들.
    - 상속/참조 에 대한 linking, delinking 기능이 필요함.
    - dirtyNode 에 대한 것도 필요함.
    - 원본 노드에 대한 참조를 가지고 있어야 한다.
  
- Project
  - VirtualDirectory 를 가지고 있으며, 하나의 rimworld version 을 뜻함
  - 참조할 원본 type data 를 가지고 있음
  - Document 도 관리함?
  
- XMLDocument
  - 원본 문서에 대해 관리 함.
  - TBD
  
- XMLDocument 와 RWXMLDocument?
  - XML 문서를 그대로 두고, RWXML 만 수정하도록 하려고 노력헀는데, 그러지 말도록 하자.
  
### 폴더 구조는 어떻게 하지?
- source code tree layout should reflect the architecture